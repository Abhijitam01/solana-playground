[
  {"line":1,"type":"macro","summary":"Import Anchor prelude types and macros.","why":"Provides Context, Result, and account helpers.","concepts":["Anchor"]},
  {"line":2,"type":"macro","summary":"Import SPL Token CPI helpers and account types.","why":"Needed to move tokens during swaps.","concepts":["SPL Token","CPI"]},
  {"line":4,"type":"macro","summary":"Declare the program ID.","why":"Identifies the on-chain program.","risk":"Program will not compile without a declared ID.","concepts":["Program ID"]},
  {"line":6,"type":"macro","summary":"Mark the module as the Anchor program entry point.","why":"Anchor generates instruction dispatch from this module.","concepts":["Instructions"]},
  {"line":7,"type":"instruction","summary":"Define the program module namespace.","concepts":["Program Structure"]},
  {"line":8,"type":"logic","summary":"Bring parent symbols into scope.","concepts":["Rust Modules"]},

  {"line":10,"type":"instruction","summary":"Define the initialize_pool instruction handler.","why":"Creates and configures the AMM pool.","concepts":["AMM","Instructions"]},
  {"line":11,"type":"logic","summary":"Create a mutable reference to the pool account.","why":"Allows writing pool configuration.","concepts":["Accounts"]},
  {"line":12,"type":"logic","summary":"Store the PDA authority key on the pool.","why":"Records who controls pool vaults.","concepts":["PDA","Authority"]},
  {"line":13,"type":"logic","summary":"Store mint A on the pool.","why":"Defines the first asset in the pair.","concepts":["Mint"]},
  {"line":14,"type":"logic","summary":"Store mint B on the pool.","why":"Defines the second asset in the pair.","concepts":["Mint"]},
  {"line":15,"type":"logic","summary":"Store the vault A token account.","why":"Tracks the reserve for mint A.","concepts":["Token Accounts"]},
  {"line":16,"type":"logic","summary":"Store the vault B token account.","why":"Tracks the reserve for mint B.","concepts":["Token Accounts"]},
  {"line":17,"type":"logic","summary":"Persist the authority PDA bump.","why":"Needed to sign CPIs later.","concepts":["PDA","Bump"]},
  {"line":18,"type":"macro","summary":"Log pool initialization.","why":"Provides feedback in transaction logs.","concepts":["Logs"]},
  {"line":19,"type":"logic","summary":"Return success from initialize_pool.","concepts":["Result"]},
  {"line":20,"type":"logic","summary":"End of initialize_pool handler.","concepts":["Rust"]},

  {"line":22,"type":"instruction","summary":"Define the swap instruction handler.","why":"Swaps between the two pool assets.","concepts":["AMM","Instructions"]},
  {"line":23,"type":"logic","summary":"Bind the pool account for reuse.","concepts":["Accounts"]},
  {"line":24,"type":"logic","summary":"Bind the input vault account.","concepts":["Token Accounts"]},
  {"line":25,"type":"logic","summary":"Bind the output vault account.","concepts":["Token Accounts"]},
  {"line":27,"type":"security","summary":"Start validation of vault pairing.","why":"Ensures swaps use the configured pool vaults.","concepts":["Validation"]},
  {"line":28,"type":"security","summary":"Allow swapping A for B.","concepts":["Validation"]},
  {"line":29,"type":"security","summary":"Allow swapping B for A.","concepts":["Validation"]},
  {"line":30,"type":"security","summary":"Use InvalidVaults error when validation fails.","concepts":["Errors"]},
  {"line":31,"type":"logic","summary":"End vault validation block.","concepts":["Validation"]},
  {"line":32,"type":"security","summary":"Ensure the pool has liquidity before swapping.","risk":"Swapping against empty reserves would break pricing.","concepts":["AMM","Validation"]},

  {"line":34,"type":"logic","summary":"Start constant-product swap math.","concepts":["AMM","Math"]},
  {"line":35,"type":"logic","summary":"Multiply input by output reserve.","concepts":["Math"]},
  {"line":36,"type":"logic","summary":"Divide by the new input reserve.","concepts":["Math"]},
  {"line":37,"type":"security","summary":"Convert overflow into an error.","concepts":["Error Handling"]},

  {"line":39,"type":"logic","summary":"Start CPI to transfer input tokens into the pool.","concepts":["CPI","SPL Token"]},
  {"line":40,"type":"logic","summary":"Build a CPI context for the transfer.","concepts":["CPI"]},
  {"line":41,"type":"account","summary":"Provide the Token Program account.","concepts":["Token Program"]},
  {"line":42,"type":"account","summary":"Begin the Transfer accounts struct.","concepts":["CPI"]},
  {"line":43,"type":"account","summary":"Source token account owned by the user.","concepts":["Token Accounts"]},
  {"line":44,"type":"account","summary":"Destination vault for the input token.","concepts":["Token Accounts"]},
  {"line":45,"type":"account","summary":"User signer authorizing the debit.","concepts":["Signer","Authority"]},
  {"line":46,"type":"logic","summary":"End the Transfer accounts struct.","concepts":["CPI"]},
  {"line":47,"type":"logic","summary":"Finish CPI context construction.","concepts":["CPI"]},
  {"line":48,"type":"logic","summary":"Specify the input amount to transfer.","concepts":["SPL Token"]},
  {"line":49,"type":"logic","summary":"Propagate CPI errors if transfer fails.","concepts":["Error Handling"]},

  {"line":51,"type":"logic","summary":"Define PDA signer seeds for the pool authority.","why":"Allows the program to sign for vault transfers.","concepts":["PDA","Signer Seeds"]},
  {"line":52,"type":"logic","summary":"Use the authority seed prefix.","concepts":["PDA"]},
  {"line":53,"type":"logic","summary":"Include the pool public key in the seeds.","concepts":["PDA"]},
  {"line":54,"type":"logic","summary":"Append the PDA bump.","concepts":["PDA","Bump"]},
  {"line":55,"type":"logic","summary":"End signer seeds definition.","concepts":["PDA"]},

  {"line":57,"type":"logic","summary":"Start CPI to transfer output tokens to the user.","concepts":["CPI","SPL Token"]},
  {"line":58,"type":"logic","summary":"Build a CPI context with signer seeds.","concepts":["CPI","PDA"]},
  {"line":59,"type":"account","summary":"Provide the Token Program account.","concepts":["Token Program"]},
  {"line":60,"type":"account","summary":"Begin the Transfer accounts struct.","concepts":["CPI"]},
  {"line":61,"type":"account","summary":"Source vault for the output token.","concepts":["Token Accounts"]},
  {"line":62,"type":"account","summary":"Destination token account for the user.","concepts":["Token Accounts"]},
  {"line":63,"type":"account","summary":"Pool authority PDA signs the transfer.","concepts":["PDA","Authority"]},
  {"line":64,"type":"logic","summary":"End the Transfer accounts struct.","concepts":["CPI"]},
  {"line":65,"type":"logic","summary":"Pass signer seeds into the CPI context.","concepts":["PDA","CPI"]},
  {"line":66,"type":"logic","summary":"Finish CPI context construction.","concepts":["CPI"]},
  {"line":67,"type":"logic","summary":"Specify the output amount to transfer.","concepts":["SPL Token"]},
  {"line":68,"type":"logic","summary":"Propagate CPI errors if transfer fails.","concepts":["Error Handling"]},

  {"line":70,"type":"macro","summary":"Log the swap amounts.","concepts":["Logs"]},
  {"line":71,"type":"logic","summary":"Return success from swap.","concepts":["Result"]},
  {"line":72,"type":"logic","summary":"End of swap handler.","concepts":["Rust"]},
  {"line":73,"type":"logic","summary":"End of program module.","concepts":["Rust Modules"]},

  {"line":75,"type":"macro","summary":"Derive account validation for InitializePool.","concepts":["Accounts"]},
  {"line":76,"type":"account","summary":"Define accounts required to initialize the pool.","concepts":["Accounts"]},
  {"line":77,"type":"account","summary":"Initialize the pool account.","concepts":["Account Initialization"]},
  {"line":78,"type":"account","summary":"Pool state account.","concepts":["Accounts"]},
  {"line":79,"type":"account","summary":"Document unchecked PDA authority.","concepts":["PDA"]},
  {"line":80,"type":"account","summary":"Derive the pool authority PDA.","concepts":["PDA"]},
  {"line":81,"type":"account","summary":"Pool authority PDA account.","concepts":["PDA"]},
  {"line":82,"type":"account","summary":"Mint A account.","concepts":["Mint"]},
  {"line":83,"type":"account","summary":"Mint B account.","concepts":["Mint"]},
  {"line":84,"type":"account","summary":"Validate vault A token account.","concepts":["Token Accounts"]},
  {"line":85,"type":"account","summary":"Vault A token account.","concepts":["Token Accounts"]},
  {"line":86,"type":"account","summary":"Validate vault B token account.","concepts":["Token Accounts"]},
  {"line":87,"type":"account","summary":"Vault B token account.","concepts":["Token Accounts"]},
  {"line":88,"type":"account","summary":"Mark payer as mutable for rent and fees.","concepts":["Signer","Payer"]},
  {"line":89,"type":"account","summary":"Payer signer account.","concepts":["Signer","Payer"]},
  {"line":90,"type":"account","summary":"Token Program account.","concepts":["Token Program"]},
  {"line":91,"type":"account","summary":"System Program account.","concepts":["System Program"]},
  {"line":92,"type":"logic","summary":"End of InitializePool accounts struct.","concepts":["Accounts"]},

  {"line":94,"type":"macro","summary":"Derive account validation for Swap.","concepts":["Accounts"]},
  {"line":95,"type":"account","summary":"Define accounts required to swap tokens.","concepts":["Accounts"]},
  {"line":96,"type":"account","summary":"Pool state account.","concepts":["Accounts"]},
  {"line":97,"type":"account","summary":"Document unchecked PDA authority.","concepts":["PDA"]},
  {"line":98,"type":"account","summary":"Derive the pool authority PDA for swaps.","concepts":["PDA"]},
  {"line":99,"type":"account","summary":"Pool authority PDA account.","concepts":["PDA"]},
  {"line":100,"type":"account","summary":"Input vault token account.","concepts":["Token Accounts"]},
  {"line":101,"type":"account","summary":"Input vault account passed in.","concepts":["Token Accounts"]},
  {"line":102,"type":"account","summary":"Output vault token account.","concepts":["Token Accounts"]},
  {"line":103,"type":"account","summary":"Output vault account passed in.","concepts":["Token Accounts"]},
  {"line":104,"type":"account","summary":"User input token account (mutable for debit).", "concepts":["Token Accounts","Mutability"]},
  {"line":105,"type":"account","summary":"User input account passed in.","concepts":["Token Accounts"]},
  {"line":106,"type":"account","summary":"User output token account (mutable for credit).", "concepts":["Token Accounts","Mutability"]},
  {"line":107,"type":"account","summary":"User output account passed in.","concepts":["Token Accounts"]},
  {"line":108,"type":"account","summary":"User signer authorizing the swap.","concepts":["Signer"]},
  {"line":109,"type":"account","summary":"Token Program account.","concepts":["Token Program"]},
  {"line":110,"type":"logic","summary":"End of Swap accounts struct.","concepts":["Accounts"]},

  {"line":112,"type":"macro","summary":"Mark the Pool struct as an account.","concepts":["Accounts"]},
  {"line":113,"type":"account","summary":"Define the Pool state struct.","concepts":["Accounts"]},
  {"line":114,"type":"account","summary":"Authority PDA public key.","concepts":["PDA","Authority"]},
  {"line":115,"type":"account","summary":"Mint A public key.","concepts":["Mint"]},
  {"line":116,"type":"account","summary":"Mint B public key.","concepts":["Mint"]},
  {"line":117,"type":"account","summary":"Vault A token account address.","concepts":["Token Accounts"]},
  {"line":118,"type":"account","summary":"Vault B token account address.","concepts":["Token Accounts"]},
  {"line":119,"type":"account","summary":"Bump seed for the PDA authority.","concepts":["PDA","Bump"]},
  {"line":120,"type":"logic","summary":"End of Pool struct.","concepts":["Accounts"]},

  {"line":122,"type":"logic","summary":"Implement helper constants for Pool.","concepts":["Rust"]},
  {"line":123,"type":"logic","summary":"Define the serialized size of Pool.","concepts":["Account Size"]},
  {"line":124,"type":"logic","summary":"End of Pool impl block.","concepts":["Rust"]},

  {"line":126,"type":"macro","summary":"Start custom error definitions.","concepts":["Errors"]},
  {"line":127,"type":"logic","summary":"Define the ErrorCode enum.","concepts":["Errors"]},
  {"line":128,"type":"macro","summary":"Message for invalid vault configuration.","concepts":["Errors"]},
  {"line":129,"type":"security","summary":"Error when vaults do not match the pool.","concepts":["Validation"]},
  {"line":130,"type":"macro","summary":"Message for empty pool.","concepts":["Errors"]},
  {"line":131,"type":"security","summary":"Error when the pool has no liquidity.","concepts":["Validation"]},
  {"line":132,"type":"macro","summary":"Message for math overflow.","concepts":["Errors"]},
  {"line":133,"type":"security","summary":"Error when swap math overflows.","concepts":["Validation","Math"]},
  {"line":134,"type":"logic","summary":"End of ErrorCode enum.","concepts":["Errors"]}
]
