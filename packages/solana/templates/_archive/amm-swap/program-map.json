{
  "flow": [
    {
      "id": "initialize",
      "title": "Initialize Pool",
      "description": "Store the pool configuration and authority PDA.",
      "lineRange": [10, 19],
      "concepts": ["AMM", "PDA", "Pool"]
    },
    {
      "id": "validate-vaults",
      "title": "Validate Vaults",
      "description": "Ensure the provided vaults match the pool configuration and are liquid.",
      "lineRange": [27, 32],
      "concepts": ["Validation", "Liquidity"]
    },
    {
      "id": "swap-math",
      "title": "Compute Swap Output",
      "description": "Apply the constant-product formula to compute the output amount.",
      "lineRange": [34, 37],
      "concepts": ["AMM", "Math"]
    },
    {
      "id": "swap-transfers",
      "title": "Execute Transfers",
      "description": "Transfer tokens into and out of the pool vaults via CPI.",
      "lineRange": [39, 68],
      "concepts": ["CPI", "Token Program"]
    }
  ],
  "instructions": [
    {
      "name": "initialize_pool",
      "lineStart": 10,
      "lineEnd": 19,
      "accounts": [
        {"name": "pool", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "pool_authority", "isMut": false, "isSigner": false, "isPda": true, "seeds": ["authority", "pool.key()"]},
        {"name": "mint_a", "isMut": false, "isSigner": false, "isPda": false},
        {"name": "mint_b", "isMut": false, "isSigner": false, "isPda": false},
        {"name": "vault_a", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "vault_b", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "payer", "isMut": true, "isSigner": true, "isPda": false},
        {"name": "token_program", "isMut": false, "isSigner": false, "isPda": false},
        {"name": "system_program", "isMut": false, "isSigner": false, "isPda": false}
      ],
      "description": "Initializes the AMM pool configuration."
    },
    {
      "name": "swap",
      "lineStart": 22,
      "lineEnd": 71,
      "accounts": [
        {"name": "pool", "isMut": false, "isSigner": false, "isPda": false},
        {"name": "pool_authority", "isMut": false, "isSigner": false, "isPda": true, "seeds": ["authority", "pool.key()"]},
        {"name": "vault_in", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "vault_out", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "user_in", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "user_out", "isMut": true, "isSigner": false, "isPda": false},
        {"name": "user", "isMut": false, "isSigner": true, "isPda": false},
        {"name": "token_program", "isMut": false, "isSigner": false, "isPda": false}
      ],
      "description": "Swaps tokens using constant-product pricing."
    }
  ],
  "accounts": [
    {
      "name": "Pool",
      "lineStart": 112,
      "lineEnd": 120,
      "fields": [
        {"name": "authority", "type": "Pubkey", "description": "PDA that controls the vaults"},
        {"name": "mint_a", "type": "Pubkey", "description": "Mint for token A"},
        {"name": "mint_b", "type": "Pubkey", "description": "Mint for token B"},
        {"name": "vault_a", "type": "Pubkey", "description": "Vault token account for token A"},
        {"name": "vault_b", "type": "Pubkey", "description": "Vault token account for token B"},
        {"name": "bump", "type": "u8", "description": "Bump seed for the PDA authority"}
      ]
    }
  ],
  "cpiCalls": [
    {"program": "spl_token", "instruction": "transfer", "description": "Move tokens between user accounts and pool vaults."}
  ]
}
